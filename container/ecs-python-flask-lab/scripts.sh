#!/bin/bash
# 379886214896.dkr.ecr.us-east-1.amazonaws.com/cda-penguin-app

yum update -y
git clone https://github.com/linuxacademy/cda-2018-flask-app.git
yum install -y docker
service docker start
usermod -a -G docker $USER
cd cda-2018-flask-app/
git checkout ecs-master
docker build -t cda-flask-app -f Dockerfile .
docker run -p 80:80 -d cda-flask-app
curl localhost
docker container ls
aws ecr create-repository --repository-name cda-penguin-app
aws ecr get-login --region us-east-1 --no-include-email
docker login -u AWS \
  -p eyJwYXlsb2FkIjoiTFBpNnpUYW96R2pjWFcxeld4Y0g0bmo0bEMrWitjdXZJaWpZSTNpVXdlbmxZanNjTGs0MnRqaUNBMFZ1S3grYTE2a1F2VUc3UlhwV3I3NG9YSkVZd1FvR1F0dlhScHhHUW1EV3hPYkw0WTFhUTdzQUVxRlNRb2lOQ0VHd2UzWmltUE1OYzVjc2FnSXdVQk55Q1FBOCtJc2J3dVIvVWN0dE5idHhzT2JBV1ZBNW1GL2xCVkx0QUdmUWQ5amZ3cEdhbGhiMnpmMjk4ak5SQ0xhcXY5NVVoNHlMZWlwT1A5RGVrKzRYVTh1MjdDWG9XUThtakQvMGkya1J6a3hiSzFkMDNRa2V5MEhOa0VMRXI3bzA0RkNzdkttYVVhM2xIZlV2RVpEZlE3cGN4elVQaXRxUlcrL2Fwc2RNRVpMekZjZTFsTjdqdVZHZlZnZlhWZEYremJBVXVGMEtYczJkcTBWV2tvZm03dGtwRlRuaG9iWTlDOVVYbEVxK0R6QVlnTHBYQzhhbGQwQ0NBYjlzdnE5dkRWSE9jdWl1MmxaMmU3SFJweThmb1BtMlR4UWRmNXJoVC8zdGRnc0M2Y1RIdE9ldElPSklkYVdLM3JHYlg4bEtwdDdyUVlSK0tWdVpic24wR3FPWWV2ODhOdEh3QkF1YTVsYzB3RitVWHd4SEV0N3VGcEVaamMxb3dwTFIxRGw4R1pGZW9PYWgzQTgycFo0MjF1aHRmc0ZaS2NZQ2ZCckNtU0RmcUE3a0Nid2doRFJueHJtY09uMUhlZHNVSkMvZUQ4d0h4bzREb0R3VWZvY2pqZnBBS2tvRG1xaHNmbktSdWlJTDNRalgrSDNpcGZEWTF5OXh4SXlxYmRIa3RtQ2kydUFDRlZ5WElkYTBGR0JPald6SFlwbGp2aUI3ajcyVTN0L2QyTG9GTU8yZ3hVWTZaaDZmVnpyOFptNWozNGkrZzlnTkNTUHdzQWp6MXdjVXJFWC9lYzJNbEc5cm5JbmFuQzB0TDNvV0VxeEhhRUIyeDlGMTEyZ0pDZXc1ODE0dlR3bHp2NmFvNmlKaUZiYWJFZ05DMWdWT2FhcStRKzJrbjh0dCtSMVZ3T3h4cGs2d3ZaUVlFNmYzdEdZdHgxUXRObDFjQXN0VTVCaXRUYXdhVFZzQ2x4dEI2V25kbEdCUFRlSWRqeWtuZGFTOC9ZK2l1Y3B0VFh2NTFVekhYaWhiMkRnZkUzZk5Ra3ZLQmlxdEU2V2M0emQ4amdlT3Q5bWtZa2krV0pxUGhZVFBMUjQ1SVdBZ09ybmJKMGViUTd2Z0JoNlM0eUNSZ25WTGphSFZRai9ORXE2YkRzU0xORTNyckRkUUtEelNiZjlEV0pTOURpNDJXMjg0dmpKL3I2cmJLeWNMTExpbDRoZWsxWG9YSUtNYmhsTmQrWmw2Y2VzV1NINjRXL0pSVGxQOGw5RlVBQWdhN2JHQkt4YkNjV3B6ZlFOeTZxRC9XSlZlVk4zUmRxS2ZGamswODFQSGhSdXJvdnJqZHZzUHk5SG5VZS9Oa09TYlgzelFyOGhFL2xZN2grbzJUNTVZaDBnamlkelRmVjdKeldXWkRrY1ZOeU1NenJELzNtZGJBendITDdEU2NsNW03VDMvVUVpa1NLOU0yUmRHV1U3Z3VnaFpnc3FINy9XVkNMWXVmNEIrd0V2ZGhFNUs1cEx3aFNCL2tjWEovNy8xVklwUDFHcDhjZmJpWThwYld3dzAxOXJRYU9FNjAvRWM1a01ha0NzekJYK3luWnIxbkVqNGtOWEV1Lyt6RGFKeUltZU8rYWdhbUVRbXloSlpYdG5MUExsRXhuM2U3V0s1Wm42K0lWK2NXUmxLcWVhYVR0OXdKSlh3OSt4MDYyZnFBZjNtRUtVdmM5Tk9ZWEJnQTF6dDZ3Ym1vdEk1TFdsdmFnM1NlakcyZGRxWlJway82WVY2cDAyaTBWRHlDdGhGRTBEU29ESDRmYUFYaXg4TnN2Mk5EeFJaZno1b283djFEdGVLamovTzJuZ0d6dlVla0tsdFFJemE0RzhjZzhMYnV5UWkxSGRiY2h3SDcxaWZjeHVLbktSM2VIdi84cWlJbTBsUENjRUpLdz09IiwiZGF0YWtleSI6IkFRRUJBSGh3bTBZYUlTSmVSdEptNW4xRzZ1cWVla1h1b1hYUGU1VUZjZTlScTgvMTR3QUFBSDR3ZkFZSktvWklodmNOQVFjR29HOHdiUUlCQURCb0Jna3Foa2lHOXcwQkJ3RXdIZ1lKWUlaSUFXVURCQUV1TUJFRURIakY2WG9CRDVxaTV3UjYzQUlCRUlBN2pGK3NrU1g2UzZPV2ZnTlJub3l0NElZSTlPekZBV2pZOTJqbHR6YkFTc0RCZ2ZMRHRUZXFwMURMZEtiWlAyaUFFY3pNaVBsWis3OENDUTQ9IiwidmVyc2lvbiI6IjIiLCJ0eXBlIjoiREFUQV9LRVkiLCJleHBpcmF0aW9uIjoxNTgzMzEyOTM0fQ== \
  https://379886214896.dkr.ecr.us-east-1.amazonaws.com
docker tag cda-flask-app:latest 379886214896.dkr.ecr.us-east-1.amazonaws.com/cda-penguin-app
docker push 379886214896.dkr.ecr.us-east-1.amazonaws.com/cda-penguin-app
